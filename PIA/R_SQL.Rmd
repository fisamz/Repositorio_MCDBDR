---
title: "Untitled"
output: github_document
---

## 1) Librerias necesarias para la conexión

```{r libraries}

library(DBI) 
library(RMariaDB)

```

## 2) Conexión a una base de datos de MySQL desde R

```{r conexion}

con <- dbConnect(
  RMariaDB::MariaDB(),
  host     = "localhost",
  port     = 3306,
  user     = "root",
  password = rstudioapi::askForPassword("MySQL password"),
  dbname   = "STUDENTS_PERFORMANCE_DB"
)

```

## 3) Revisar las tablas existentes en la base de datos asi como los atributos de cada tabla:

```{r detalle1}

dbListTables(con) #Revisa tablas en la base de datos
dbListFields(con, "Grades") #Revisa los atributos de una de las tablas

```


## 4) Consulta a la base de datos manteniendo el languaje SQL:

```{r detalle2}

dbReadTable(con, "School") #Extrae todos los datos de una de las tablas

califs <- dbGetQuery(con, "SELECT * FROM Grades")

califs

res <- dbGetQuery(con, "
  SELECT student_id, course_id, G3
  FROM Grades
  WHERE G3 > 0
  LIMIT 50
")

res

```

## 5) Creación de tablas

```{r detalle3}

df <- data.frame(
  name = c("Ana", "Luis", "María"),
  score = c(10, 11, 12)
)

dbWriteTable(
  con,
  "scores",
  df,
  overwrite = TRUE,
  field.types = c(name = "VARCHAR(20)", score = "INT")
)

new_df <- data.frame(
  name = c("Carlos", "Elena"),
  score = c(88, 95)
)

dbWriteTable(con, "scores", new_df, append = TRUE)
#Aquí usamos append = TRUE para añadir filas sin eliminar lo ya existente

```

## 6) Creación de tablas

```{r detalle4}

# Verifica que la tabla existe, en caso de que si, borrarla

if ( dbExistsTable(con, "scores") == TRUE) { dbRemoveTable(con, "scores") }

```

## 7) Uso de dplyr para consultas

```{r detalle5}

library(dplyr)
library(dbplyr)

grades_tbl <- tbl(con, "Grades")

grades_high <- grades_tbl %>%
  filter(G3 > 0) %>%
  select(student_id, course_id, G3) %>%
  collect()

head(grades_high)

```


## 9) Importante al final, desconectar la sesión

```{r detalle6}

  dbDisconnect(con)


```
